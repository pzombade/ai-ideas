<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Learn & Play! üåà</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #FFF8EE;
    --tab-letters:  #FF6B6B;
    --tab-numbers:  #4D96FF;
    --tab-weekdays: #6BCB77;
    --tab-months:   #C56BFF;
    --tab-words:    #FF9F43;
  }

  body {
    font-family: 'Nunito', sans-serif;
    background: var(--bg);
    min-height: 100vh;
    padding: 14px 12px 30px;
    background-image:
      radial-gradient(circle at 10% 10%, rgba(255,200,100,0.15) 0%, transparent 40%),
      radial-gradient(circle at 90% 90%, rgba(100,200,255,0.15) 0%, transparent 40%),
      radial-gradient(circle at 80% 10%, rgba(255,150,200,0.12) 0%, transparent 40%);
  }

  /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
  header {
    text-align: center;
    margin-bottom: 10px;
    position: relative;
  }
  header h1 {
    font-family: 'Fredoka One', cursive;
    font-size: clamp(2rem, 7vw, 3.2rem);
    background: linear-gradient(135deg, #FF6B6B, #FFD93D, #6BCB77, #4D96FF);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    filter: drop-shadow(2px 3px 0 rgba(0,0,0,0.08));
    line-height: 1.1;
  }
  header p {
    font-size: 0.82rem;
    color: #999;
    margin-top: 2px;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  /* ‚îÄ‚îÄ Top Controls Bar ‚îÄ‚îÄ */
  .top-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin-bottom: 14px;
    flex-wrap: wrap;
  }

  /* Music toggle */
  .btn-music {
    font-family: 'Fredoka One', cursive;
    font-size: 0.88rem;
    border: none;
    border-radius: 50px;
    padding: 8px 16px;
    cursor: pointer;
    background: #FFD93D;
    color: #7a5800;
    box-shadow: 0 4px 0 #cc9900;
    transition: transform 0.1s, box-shadow 0.1s, background 0.2s;
    display: flex; align-items: center; gap: 6px;
  }
  .btn-music:active { transform: translateY(3px); box-shadow: 0 1px 0 #cc9900; }
  .btn-music.on  { background: #FFD93D; }
  .btn-music.off { background: #ddd; color: #888; box-shadow: 0 4px 0 #aaa; }

  /* Spell-out toggle */
  .spell-toggle-wrap {
    display: flex;
    align-items: center;
    gap: 8px;
    background: #fff;
    border-radius: 50px;
    padding: 7px 14px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    font-size: 0.82rem;
    font-weight: 900;
    color: #555;
  }
  .spell-toggle-wrap span { white-space: nowrap; }

  .toggle-switch {
    position: relative;
    width: 44px; height: 24px;
    cursor: pointer;
  }
  .toggle-switch input { display: none; }
  .toggle-track {
    position: absolute;
    inset: 0;
    background: #ddd;
    border-radius: 50px;
    transition: background 0.2s;
  }
  .toggle-switch input:checked + .toggle-track { background: #6BCB77; }
  .toggle-knob {
    position: absolute;
    top: 3px; left: 3px;
    width: 18px; height: 18px;
    background: #fff;
    border-radius: 50%;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    transition: transform 0.2s;
  }
  .toggle-switch input:checked ~ .toggle-knob { transform: translateX(20px); }

  /* ‚îÄ‚îÄ Tab Bar ‚îÄ‚îÄ */
  .tabs {
    display: flex;
    gap: 8px;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 14px;
  }
  .tab-btn {
    font-family: 'Fredoka One', cursive;
    font-size: clamp(0.78rem, 2.2vw, 0.95rem);
    border: none;
    border-radius: 50px;
    padding: 9px 16px;
    cursor: pointer;
    color: #fff;
    opacity: 0.48;
    box-shadow: 0 4px 0 rgba(0,0,0,0.15);
    transition: opacity 0.15s, transform 0.15s, box-shadow 0.15s;
  }
  .tab-btn:hover  { opacity: 0.72; }
  .tab-btn.active { opacity: 1; transform: translateY(-2px); box-shadow: 0 6px 0 rgba(0,0,0,0.18); }
  .tab-btn[data-tab="letters"]  { background: var(--tab-letters); }
  .tab-btn[data-tab="numbers"]  { background: var(--tab-numbers); }
  .tab-btn[data-tab="weekdays"] { background: var(--tab-weekdays); }
  .tab-btn[data-tab="months"]   { background: var(--tab-months); }
  .tab-btn[data-tab="words"]    { background: var(--tab-words); }

  /* ‚îÄ‚îÄ Section ‚îÄ‚îÄ */
  .section-panel { display: none; }
  .section-panel.active { display: block; }

  /* Section top row: title + Read All + progress */
  .section-header {
    max-width: 800px;
    margin: 0 auto 10px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 8px;
  }
  .section-title {
    font-family: 'Fredoka One', cursive;
    font-size: 1rem;
    color: #bbb;
    letter-spacing: 1.5px;
    text-transform: uppercase;
  }

  /* Read All button */
  .btn-read-all {
    font-family: 'Fredoka One', cursive;
    font-size: 0.9rem;
    border: none;
    border-radius: 50px;
    padding: 9px 18px;
    cursor: pointer;
    color: #fff;
    box-shadow: 0 4px 0 rgba(0,0,0,0.2);
    display: flex; align-items: center; gap: 6px;
    transition: transform 0.1s, box-shadow 0.1s;
  }
  .btn-read-all:hover  { transform: translateY(-2px); box-shadow: 0 6px 0 rgba(0,0,0,0.2); }
  .btn-read-all:active { transform: translateY(2px);  box-shadow: 0 2px 0 rgba(0,0,0,0.2); }
  .btn-read-all.letters-color  { background: var(--tab-letters);  box-shadow: 0 4px 0 #c0392b; }
  .btn-read-all.numbers-color  { background: var(--tab-numbers);  box-shadow: 0 4px 0 #1a6bbf; }
  .btn-read-all.weekdays-color { background: var(--tab-weekdays); box-shadow: 0 4px 0 #1e8449; }
  .btn-read-all.months-color   { background: var(--tab-months);   box-shadow: 0 4px 0 #7d3c98; }
  .btn-read-all.words-color    { background: var(--tab-words);    box-shadow: 0 4px 0 #cc6d00; }
  .btn-read-all.stop { background: #FF4757 !important; box-shadow: 0 4px 0 #c0392b !important; }

  /* ‚îÄ‚îÄ Word Family Grid ‚îÄ‚îÄ */
  .grid-words { grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); }

  /* ‚îÄ‚îÄ Word Detail Panel ‚îÄ‚îÄ */
  .word-detail-overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.55);
    backdrop-filter: blur(6px);
    display: flex; align-items: center; justify-content: center;
    z-index: 100;
    opacity: 0; pointer-events: none;
    transition: opacity 0.22s ease;
    padding: 16px;
  }
  .word-detail-overlay.active { opacity: 1; pointer-events: all; }

  .word-detail-panel {
    background: #fff;
    border-radius: 28px;
    padding: 20px 18px 18px;
    width: 100%; max-width: 480px;
    position: relative;
    box-shadow: 0 24px 60px rgba(0,0,0,0.22);
    transform: scale(0.88) translateY(20px);
    transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1);
    max-height: 92vh; overflow-y: auto;
  }
  .word-detail-overlay.active .word-detail-panel { transform: scale(1) translateY(0); }

  .word-detail-band { position: absolute; top: 0; left: 0; right: 0; height: 8px; border-radius: 26px 26px 0 0; background: var(--tab-words); }

  .word-family-title {
    font-family: 'Fredoka One', cursive;
    font-size: 1.6rem; text-align: center;
    color: var(--tab-words); margin: 8px 0 14px;
    letter-spacing: 2px;
  }

  /* Word cards inside detail */
  .word-cards-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-bottom: 16px;
  }

  .word-card {
    background: linear-gradient(155deg, #FF9F43, #FF6348);
    border-radius: 16px;
    padding: 12px 6px 10px;
    text-align: center;
    border: 3px solid rgba(255,255,255,0.5);
    box-shadow: 0 4px 0 rgba(0,0,0,0.12);
    cursor: pointer;
    transition: transform 0.12s, box-shadow 0.12s;
    position: relative; overflow: hidden;
  }
  .word-card::before {
    content: '';
    position: absolute; top: 0; left: 0; right: 0; height: 38%;
    background: rgba(255,255,255,0.2);
    border-radius: 13px 13px 60% 60%;
  }
  .word-card:hover  { transform: translateY(-3px) scale(1.04); box-shadow: 0 7px 0 rgba(0,0,0,0.12); }
  .word-card:active { transform: translateY(2px); box-shadow: 0 1px 0 rgba(0,0,0,0.12); }

  .word-card .wc-emoji { font-size: 2.2rem; line-height: 1; display: block; }
  .word-card .wc-word  {
    font-family: 'Fredoka One', cursive;
    font-size: 1.3rem; color: #fff;
    text-shadow: 1px 2px 0 rgba(0,0,0,0.15);
    display: block; margin-top: 4px;
  }

  /* Quiz section inside word detail */
  .quiz-divider {
    text-align: center;
    font-family: 'Fredoka One', cursive;
    font-size: 0.85rem; color: #ccc;
    letter-spacing: 2px; text-transform: uppercase;
    margin: 4px 0 12px;
    display: flex; align-items: center; gap: 8px;
  }
  .quiz-divider::before, .quiz-divider::after {
    content: ''; flex: 1; height: 1px; background: #eee;
  }

  .btn-start-quiz {
    font-family: 'Fredoka One', cursive;
    font-size: 1rem; border: none; border-radius: 50px;
    padding: 11px 28px; cursor: pointer;
    background: linear-gradient(135deg, #FF9F43, #FF6348);
    color: #fff; box-shadow: 0 5px 0 #cc4400;
    width: 100%;
    transition: transform 0.1s, box-shadow 0.1s;
    display: flex; align-items: center; justify-content: center; gap: 8px;
  }
  .btn-start-quiz:hover  { transform: translateY(-2px); box-shadow: 0 7px 0 #cc4400; }
  .btn-start-quiz:active { transform: translateY(3px);  box-shadow: 0 2px 0 #cc4400; }

  /* ‚îÄ‚îÄ Quiz Overlay ‚îÄ‚îÄ */
  .quiz-overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.65);
    backdrop-filter: blur(8px);
    display: flex; align-items: center; justify-content: center;
    z-index: 150;
    opacity: 0; pointer-events: none;
    transition: opacity 0.22s;
    padding: 16px;
  }
  .quiz-overlay.active { opacity: 1; pointer-events: all; }

  .quiz-box {
    background: #fff;
    border-radius: 28px;
    padding: 24px 20px 20px;
    width: 100%; max-width: 420px;
    text-align: center;
    box-shadow: 0 24px 60px rgba(0,0,0,0.25);
    transform: scale(0.88) translateY(20px);
    transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1);
    position: relative;
  }
  .quiz-overlay.active .quiz-box { transform: scale(1) translateY(0); }

  .quiz-band { position: absolute; top: 0; left: 0; right: 0; height: 8px; border-radius: 26px 26px 0 0; background: var(--tab-words); }

  .quiz-progress-row {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 10px;
  }
  .quiz-q-count { font-family: 'Fredoka One', cursive; font-size: 0.9rem; color: #bbb; }
  .quiz-score-badge {
    font-family: 'Fredoka One', cursive; font-size: 0.9rem;
    background: #FFF3CD; color: #cc8800;
    padding: 4px 12px; border-radius: 50px;
  }

  .quiz-emoji-big { font-size: 5rem; line-height: 1; margin: 6px 0 8px; display: block;
    animation: popIn 0.4s cubic-bezier(0.34,1.56,0.64,1); }

  .quiz-prompt {
    font-family: 'Fredoka One', cursive;
    font-size: 1rem; color: #999;
    margin-bottom: 6px; letter-spacing: 1px;
  }

  .btn-quiz-speak {
    background: none; border: none; cursor: pointer;
    font-size: 1.5rem; margin-bottom: 10px;
    transition: transform 0.15s;
  }
  .btn-quiz-speak:hover { transform: scale(1.2); }

  .quiz-choices {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-top: 8px;
  }

  .quiz-choice {
    font-family: 'Fredoka One', cursive;
    font-size: 1.5rem;
    border: 3px solid #eee;
    border-radius: 16px;
    padding: 14px 8px;
    cursor: pointer;
    background: #fff;
    color: #444;
    transition: transform 0.1s, border-color 0.15s, background 0.15s;
    box-shadow: 0 3px 0 #ddd;
    letter-spacing: 1px;
  }
  .quiz-choice:hover  { border-color: #FF9F43; transform: translateY(-2px); }
  .quiz-choice:active { transform: translateY(2px); box-shadow: 0 1px 0 #ddd; }
  .quiz-choice.correct { background: #d4edda; border-color: #6BCB77; color: #1e8449; animation: correctPop 0.3s; }
  .quiz-choice.wrong   { background: #fde8e8; border-color: #FF6B6B; color: #c0392b; animation: wrongShake 0.3s; }

  @keyframes correctPop  { 0%,100%{transform:scale(1)} 50%{transform:scale(1.08)} }
  @keyframes wrongShake  { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-6px)} 75%{transform:translateX(6px)} }

  .btn-quiz-close {
    position: absolute; top: 13px; right: 13px;
    width: 34px; height: 34px; border-radius: 50%;
    border: none; background: #f0f0f0; font-size: 1rem;
    cursor: pointer; color: #555; font-weight: 900;
    display: flex; align-items: center; justify-content: center;
    transition: background 0.15s, transform 0.15s;
  }
  .btn-quiz-close:hover { background: #FFD93D; transform: rotate(90deg); }

  /* Progress bar */
  .progress-wrap {
    max-width: 800px;
    margin: 0 auto 12px;
    background: rgba(0,0,0,0.06);
    border-radius: 50px;
    height: 14px;
    overflow: hidden;
    position: relative;
  }
  .progress-bar {
    height: 100%;
    border-radius: 50px;
    transition: width 0.4s ease;
    background: linear-gradient(90deg, #FFD93D, #FF6B6B);
    min-width: 0;
  }
  .progress-label {
    position: absolute;
    right: 8px; top: 0;
    font-size: 0.62rem;
    font-weight: 900;
    color: rgba(0,0,0,0.4);
    line-height: 14px;
  }
  .progress-stars {
    max-width: 800px;
    margin: 0 auto 10px;
    text-align: right;
    font-size: 0.75rem;
    color: #FFD93D;
    font-weight: 900;
    letter-spacing: 1px;
    min-height: 18px;
  }

  /* ‚îÄ‚îÄ Grids ‚îÄ‚îÄ */
  .grid {
    display: grid;
    gap: 10px;
    max-width: 800px;
    margin: 0 auto;
  }
  .grid-letters  { grid-template-columns: repeat(auto-fill, minmax(82px,  1fr)); }
  .grid-numbers  { grid-template-columns: repeat(auto-fill, minmax(90px,  1fr)); }
  .grid-weekdays { grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); }
  .grid-months   { grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); }

  /* ‚îÄ‚îÄ Tiles ‚îÄ‚îÄ */
  .tile {
    border-radius: 18px;
    padding: 12px 6px 10px;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 3px;
    border: 3px solid rgba(255,255,255,0.55);
    box-shadow: 0 5px 0 rgba(0,0,0,0.13), 0 7px 18px rgba(0,0,0,0.07);
    transition: transform 0.12s, box-shadow 0.12s, outline 0.1s;
    user-select: none;
    position: relative;
    overflow: hidden;
  }
  .tile::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 38%;
    background: rgba(255,255,255,0.22);
    border-radius: 15px 15px 60% 60%;
  }
  .tile:hover  { transform: translateY(-4px) scale(1.05); box-shadow: 0 9px 0 rgba(0,0,0,0.13), 0 14px 24px rgba(0,0,0,0.1); }
  .tile:active { transform: translateY(2px) scale(0.97); box-shadow: 0 2px 0 rgba(0,0,0,0.12); }

  /* Highlighted tile during Read All */
  .tile.reading {
    outline: 4px solid #FFD93D;
    outline-offset: 2px;
    transform: translateY(-5px) scale(1.08) !important;
    box-shadow: 0 10px 0 rgba(0,0,0,0.13), 0 16px 30px rgba(255,215,0,0.3) !important;
    z-index: 2;
  }

  /* Visited tile tick */
  .tile.visited::after {
    content: '‚úì';
    position: absolute;
    top: 5px; right: 7px;
    font-size: 0.65rem;
    font-weight: 900;
    color: rgba(255,255,255,0.9);
    background: rgba(0,0,0,0.18);
    border-radius: 50%;
    width: 16px; height: 16px;
    display: flex; align-items: center; justify-content: center;
    line-height: 16px;
    text-align: center;
  }

  .tile .t-main  { font-family: 'Fredoka One', cursive; font-size: 2.1rem; color:#fff; text-shadow: 2px 3px 0 rgba(0,0,0,0.14); line-height:1; }
  .tile .t-emoji { font-size: 1.25rem; line-height: 1; }
  .tile .t-sub   { font-size: 0.58rem; font-weight:900; color:rgba(255,255,255,0.88); text-transform:uppercase; letter-spacing:1px; }

  .col-red    { background: linear-gradient(155deg,#FF6B6B,#FF4757); }
  .col-orange { background: linear-gradient(155deg,#FF9F43,#FF6348); }
  .col-yellow { background: linear-gradient(155deg,#FFD93D,#FFAA00); }
  .col-green  { background: linear-gradient(155deg,#6BCB77,#2ECC71); }
  .col-blue   { background: linear-gradient(155deg,#4D96FF,#2E86DE); }
  .col-purple { background: linear-gradient(155deg,#C56BFF,#9B59B6); }
  .col-pink   { background: linear-gradient(155deg,#FF6EB4,#FF2D78); }
  .col-teal   { background: linear-gradient(155deg,#00CEC9,#00A896); }

  /* ‚îÄ‚îÄ Modal ‚îÄ‚îÄ */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    backdrop-filter: blur(6px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 100;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.22s ease;
    padding: 16px;
  }
  .modal-overlay.active { opacity: 1; pointer-events: all; }

  .modal {
    background: #fff;
    border-radius: 30px;
    padding: 26px 22px 22px;
    width: 100%;
    max-width: 400px;
    text-align: center;
    position: relative;
    box-shadow: 0 24px 60px rgba(0,0,0,0.22);
    transform: scale(0.85) translateY(20px);
    transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1);
    max-height: 92vh;
    overflow-y: auto;
  }
  .modal-overlay.active .modal { transform: scale(1) translateY(0); }

  .modal-band { position: absolute; top: 0; left: 0; right: 0; height: 8px; border-radius: 28px 28px 0 0; }

  .btn-close {
    position: absolute; top: 13px; right: 13px;
    width: 36px; height: 36px;
    border-radius: 50%; border: none;
    background: #F0F0F0; font-size: 1.1rem; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: background 0.15s, transform 0.15s;
    color: #555; font-weight: 900;
  }
  .btn-close:hover { background: #FFD93D; transform: scale(1.1) rotate(90deg); }

  .modal-main-label {
    font-family: 'Fredoka One', cursive;
    font-size: 5rem; line-height: 1; margin-top: 10px;
    background: linear-gradient(135deg,#FF6B6B,#4D96FF);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    filter: drop-shadow(3px 4px 0 rgba(0,0,0,0.07));
  }
  .modal-word-label {
    font-family: 'Fredoka One', cursive;
    font-size: 1.55rem; color: #444; letter-spacing: 3px; margin: 4px 0 8px;
  }
  .modal-emoji-sprite {
    font-size: 5rem; line-height: 1; margin: 4px 0 8px; display: block;
    animation: popIn 0.45s cubic-bezier(0.34,1.56,0.64,1);
  }
  .count-grid {
    display: flex; flex-wrap: wrap; justify-content: center; align-items: center;
    gap: 4px; margin: 6px auto 10px; max-width: 320px; min-height: 60px;
  }

  @keyframes popIn {
    0%   { transform: scale(0.5) translateY(16px); opacity: 0; }
    100% { transform: scale(1) translateY(0); opacity: 1; }
  }

  .btn-speak {
    background: linear-gradient(135deg,#6BCB77,#2ECC71);
    color: #fff; border: none; border-radius: 50px;
    padding: 11px 26px;
    font-family: 'Fredoka One', cursive; font-size: 1.05rem;
    cursor: pointer; display: inline-flex; align-items: center; gap: 8px;
    box-shadow: 0 5px 0 #1aab53, 0 7px 14px rgba(0,0,0,0.13);
    transition: transform 0.1s, box-shadow 0.1s; margin-bottom: 16px;
  }
  .btn-speak:hover  { transform: translateY(-2px); box-shadow: 0 7px 0 #1aab53, 0 10px 20px rgba(0,0,0,0.13); }
  .btn-speak:active { transform: translateY(3px);  box-shadow: 0 2px 0 #1aab53; }
  .btn-speak.speaking { background: linear-gradient(135deg,#FFD93D,#FFAA00); box-shadow: 0 5px 0 #cc8800, 0 7px 14px rgba(0,0,0,0.13); }

  .speaking-dots { display:none; justify-content:center; gap:5px; margin-top:2px; height:14px; margin-bottom:10px; }
  .speaking-dots.visible { display:flex; }
  .speaking-dots span { width:8px; height:8px; border-radius:50%; background:#6BCB77; animation: dotBounce 0.6s infinite alternate; }
  .speaking-dots span:nth-child(2) { animation-delay:0.2s; }
  .speaking-dots span:nth-child(3) { animation-delay:0.4s; }
  @keyframes dotBounce {
    from { transform:translateY(0); opacity:0.5; }
    to   { transform:translateY(-6px); opacity:1; }
  }

  .nav-row { display:flex; align-items:center; justify-content:center; gap:14px; }
  .btn-nav {
    width:50px; height:50px; border-radius:50%; border:none;
    font-size:1.4rem; cursor:pointer;
    display:flex; align-items:center; justify-content:center;
    box-shadow: 0 4px 0 rgba(0,0,0,0.15);
    transition: transform 0.1s, box-shadow 0.1s; font-weight:900; color:#fff;
  }
  .btn-nav:hover  { transform:scale(1.1); }
  .btn-nav:active { transform:scale(0.95); box-shadow: 0 1px 0 rgba(0,0,0,0.15); }
  .btn-prev { background:#4D96FF; }
  .btn-next { background:#FF6B6B; }
  .nav-counter { font-family:'Fredoka One',cursive; font-size:0.95rem; color:#bbb; min-width:55px; }

  /* ‚îÄ‚îÄ Well Done Screen ‚îÄ‚îÄ */
  .wellDone-overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(8px);
    display: flex; align-items: center; justify-content: center;
    z-index: 200;
    opacity: 0; pointer-events: none;
    transition: opacity 0.3s;
    padding: 20px;
  }
  .wellDone-overlay.active { opacity: 1; pointer-events: all; }

  .wellDone-box {
    background: #fff;
    border-radius: 36px;
    padding: 40px 30px 32px;
    text-align: center;
    max-width: 380px; width: 100%;
    box-shadow: 0 30px 80px rgba(0,0,0,0.3);
    transform: scale(0.7);
    transition: transform 0.4s cubic-bezier(0.34,1.56,0.64,1);
  }
  .wellDone-overlay.active .wellDone-box { transform: scale(1); }

  .wellDone-emoji { font-size: 5rem; line-height: 1; margin-bottom: 12px; display: block;
    animation: spinBounce 0.6s cubic-bezier(0.34,1.56,0.64,1); }
  @keyframes spinBounce {
    0%   { transform: scale(0) rotate(-180deg); }
    100% { transform: scale(1) rotate(0deg); }
  }
  .wellDone-title {
    font-family: 'Fredoka One', cursive;
    font-size: 2.8rem;
    background: linear-gradient(135deg,#FF6B6B,#FFD93D,#6BCB77,#4D96FF);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    margin-bottom: 8px;
  }
  .wellDone-sub {
    font-family: 'Fredoka One', cursive;
    font-size: 1.1rem; color: #aaa; margin-bottom: 24px; letter-spacing: 1px;
  }
  .btn-wellDone-close {
    font-family: 'Fredoka One', cursive;
    font-size: 1.1rem; border: none; border-radius: 50px;
    padding: 12px 32px; cursor: pointer;
    background: linear-gradient(135deg,#6BCB77,#2ECC71);
    color: #fff; box-shadow: 0 5px 0 #1aab53;
    transition: transform 0.1s;
  }
  .btn-wellDone-close:hover { transform: translateY(-2px); }

  /* ‚îÄ‚îÄ Confetti ‚îÄ‚îÄ */
  .confetti-container { position:fixed; inset:0; pointer-events:none; z-index:999; overflow:hidden; }
  .confetti-piece {
    position:absolute; border-radius:2px;
    animation: confettiFall 1.8s ease forwards;
  }
  @keyframes confettiFall {
    0%   { transform:translateY(-20px) rotate(0deg);  opacity:1; }
    100% { transform:translateY(105vh) rotate(720deg); opacity:0; }
  }
</style>
</head>
<body>

<header>
  <h1>üåà Learn &amp; Play!</h1>
  <p>Tap anything to learn! üéâ</p>
</header>

<!-- Top Controls -->
<div class="top-controls">
  <button class="btn-music on" id="btnMusic">üéµ Music: ON</button>

  <div class="spell-toggle-wrap">
    <span>üî§ Spelling</span>
    <label class="toggle-switch">
      <input type="checkbox" id="spellToggle" checked>
      <div class="toggle-track"></div>
      <div class="toggle-knob"></div>
    </label>
    <span id="spellLabel">ON</span>
  </div>
</div>

<!-- Tabs -->
<div class="tabs">
  <button class="tab-btn active" data-tab="letters">üî§ Letters</button>
  <button class="tab-btn"        data-tab="numbers">üî¢ Numbers</button>
  <button class="tab-btn"        data-tab="weekdays">üìÖ Weekdays</button>
  <button class="tab-btn"        data-tab="months">üóìÔ∏è Months</button>
  <button class="tab-btn"        data-tab="words">‚úèÔ∏è Words</button>
</div>

<!-- Letters -->
<div class="section-panel active" id="panel-letters">
  <div class="section-header">
    <div class="section-title">üî§ A to Z</div>
    <button class="btn-read-all letters-color" id="readAll-letters">‚ñ∂ Read All</button>
  </div>
  <div class="progress-wrap"><div class="progress-bar" id="prog-letters" style="width:0%"></div><span class="progress-label" id="progLabel-letters">0/26</span></div>
  <div class="progress-stars" id="stars-letters"></div>
  <div class="grid grid-letters" id="grid-letters"></div>
</div>

<!-- Numbers -->
<div class="section-panel" id="panel-numbers">
  <div class="section-header">
    <div class="section-title">üî¢ 1 to 20</div>
    <button class="btn-read-all numbers-color" id="readAll-numbers">‚ñ∂ Read All</button>
  </div>
  <div class="progress-wrap"><div class="progress-bar" id="prog-numbers" style="width:0%"></div><span class="progress-label" id="progLabel-numbers">0/20</span></div>
  <div class="progress-stars" id="stars-numbers"></div>
  <div class="grid grid-numbers" id="grid-numbers"></div>
</div>

<!-- Weekdays -->
<div class="section-panel" id="panel-weekdays">
  <div class="section-header">
    <div class="section-title">üìÖ Weekdays</div>
    <button class="btn-read-all weekdays-color" id="readAll-weekdays">‚ñ∂ Read All</button>
  </div>
  <div class="progress-wrap"><div class="progress-bar" id="prog-weekdays" style="width:0%"></div><span class="progress-label" id="progLabel-weekdays">0/7</span></div>
  <div class="progress-stars" id="stars-weekdays"></div>
  <div class="grid grid-weekdays" id="grid-weekdays"></div>
</div>

<!-- Months -->
<div class="section-panel" id="panel-months">
  <div class="section-header">
    <div class="section-title">üóìÔ∏è Months</div>
    <button class="btn-read-all months-color" id="readAll-months">‚ñ∂ Read All</button>
  </div>
  <div class="progress-wrap"><div class="progress-bar" id="prog-months" style="width:0%"></div><span class="progress-label" id="progLabel-months">0/12</span></div>
  <div class="progress-stars" id="stars-months"></div>
  <div class="grid grid-months" id="grid-months"></div>
</div>

<!-- Words -->
<div class="section-panel" id="panel-words">
  <div class="section-header">
    <div class="section-title">‚úèÔ∏è Word Families</div>
  </div>
  <div class="progress-wrap"><div class="progress-bar" id="prog-words" style="width:0%"></div><span class="progress-label" id="progLabel-words">0/10</span></div>
  <div class="progress-stars" id="stars-words"></div>
  <div class="grid grid-words" id="grid-words"></div>
</div>

<!-- Word Detail Panel -->
<div class="word-detail-overlay" id="wordDetailOverlay">
  <div class="word-detail-panel">
    <div class="word-detail-band"></div>
    <button class="btn-close" id="btnWordDetailClose">‚úï</button>
    <div class="word-family-title" id="wordFamilyTitle">-AT Words</div>
    <div class="word-cards-grid" id="wordCardsGrid"></div>
    <div class="quiz-divider">Quiz Time</div>
    <button class="btn-start-quiz" id="btnStartQuiz">üéØ Take the Quiz!</button>
  </div>
</div>

<!-- Quiz Overlay -->
<div class="quiz-overlay" id="quizOverlay">
  <div class="quiz-box">
    <div class="quiz-band"></div>
    <button class="btn-quiz-close" id="btnQuizClose">‚úï</button>
    <div class="quiz-progress-row">
      <div class="quiz-q-count" id="quizQCount">Q 1 / 3</div>
      <div class="quiz-score-badge">‚≠ê <span id="quizScore">0</span></div>
    </div>
    <span class="quiz-emoji-big" id="quizEmoji">üê±</span>
    <div class="quiz-prompt">Which spelling is correct?</div>
    <button class="btn-quiz-speak" id="btnQuizSpeak" title="Hear the word">üîä</button>
    <div class="quiz-choices" id="quizChoices"></div>
  </div>
</div>
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <div class="modal-band" id="modalBand"></div>
    <button class="btn-close" id="btnClose">‚úï</button>
    <div class="modal-main-label" id="modalMain"></div>
    <div class="modal-word-label" id="modalWordLabel"></div>
    <div class="modal-emoji-sprite" id="modalEmoji"></div>
    <div class="count-grid" id="countGrid"></div>
    <button class="btn-speak" id="btnSpeak">üîä Say It!</button>
    <div class="speaking-dots" id="speakDots"><span></span><span></span><span></span></div>
    <div class="nav-row">
      <button class="btn-nav btn-prev" id="btnPrev">‚óÄ</button>
      <div class="nav-counter" id="navCounter">1 / 26</div>
      <button class="btn-nav btn-next" id="btnNext">‚ñ∂</button>
    </div>
  </div>
</div>

<!-- Well Done -->
<div class="wellDone-overlay" id="wellDoneOverlay">
  <div class="wellDone-box">
    <span class="wellDone-emoji">üèÜ</span>
    <div class="wellDone-title">Amazing!</div>
    <div class="wellDone-sub" id="wellDoneSub">You finished all the Letters!</div>
    <button class="btn-wellDone-close" id="btnWellDoneClose">üéâ Yay! Let's Go!</button>
  </div>
</div>

<div class="confetti-container" id="confettiContainer"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const LETTERS = [
  {letter:'A',emoji:'üçé',word:'Apple'},
  {letter:'B',emoji:'‚öΩ',word:'Ball'},
  {letter:'C',emoji:'üê±',word:'Cat'},
  {letter:'D',emoji:'üê∂',word:'Dog'},
  {letter:'E',emoji:'üêò',word:'Elephant'},
  {letter:'F',emoji:'üêü',word:'Fish'},
  {letter:'G',emoji:'üçá',word:'Grapes'},
  {letter:'H',emoji:'üé©',word:'Hat'},
  {letter:'I',emoji:'üç¶',word:'Ice Cream'},
  {letter:'J',emoji:'ü™º',word:'Jellyfish'},
  {letter:'K',emoji:'ü™Å',word:'Kite'},
  {letter:'L',emoji:'ü¶Å',word:'Lion'},
  {letter:'M',emoji:'üêí',word:'Monkey'},
  {letter:'N',emoji:'ü™∫',word:'Nest'},
  {letter:'O',emoji:'üçä',word:'Orange'},
  {letter:'P',emoji:'üêº',word:'Panda'},
  {letter:'Q',emoji:'üë∏',word:'Queen'},
  {letter:'R',emoji:'üåà',word:'Rainbow'},
  {letter:'S',emoji:'‚òÄÔ∏è',word:'Sun'},
  {letter:'T',emoji:'üêØ',word:'Tiger'},
  {letter:'U',emoji:'‚òÇÔ∏è',word:'Umbrella'},
  {letter:'V',emoji:'üéª',word:'Violin'},
  {letter:'W',emoji:'üçâ',word:'Watermelon'},
  {letter:'X',emoji:'üéÑ',word:'Xmas'},
  {letter:'Y',emoji:'ü™Ä',word:'Yo-yo'},
  {letter:'Z',emoji:'ü¶ì',word:'Zebra'},
];
const NUMBERS = [
  {num:1, word:'One',       emoji:'üçé'},{num:2, word:'Two',       emoji:'üåü'},
  {num:3, word:'Three',     emoji:'üå∏'},{num:4, word:'Four',      emoji:'üç≠'},
  {num:5, word:'Five',      emoji:'üê£'},{num:6, word:'Six',       emoji:'üçì'},
  {num:7, word:'Seven',     emoji:'üåà'},{num:8, word:'Eight',     emoji:'ü¶ã'},
  {num:9, word:'Nine',      emoji:'üçÄ'},{num:10,word:'Ten',       emoji:'üéà'},
  {num:11,word:'Eleven',    emoji:'‚≠ê'},{num:12,word:'Twelve',    emoji:'üçï'},
  {num:13,word:'Thirteen',  emoji:'üê†'},{num:14,word:'Fourteen',  emoji:'üåª'},
  {num:15,word:'Fifteen',   emoji:'üéµ'},{num:16,word:'Sixteen',   emoji:'üç¶'},
  {num:17,word:'Seventeen', emoji:'ü¶Ñ'},{num:18,word:'Eighteen',  emoji:'üå∫'},
  {num:19,word:'Nineteen',  emoji:'üçá'},{num:20,word:'Twenty',    emoji:'üéâ'},
];
const WEEKDAYS = [
  {name:'Monday',   emoji:'‚òÄÔ∏è', short:'Mon'},
  {name:'Tuesday',  emoji:'üå§Ô∏è',short:'Tue'},
  {name:'Wednesday',emoji:'üåà', short:'Wed'},
  {name:'Thursday', emoji:'‚ö°', short:'Thu'},
  {name:'Friday',   emoji:'üéâ', short:'Fri'},
  {name:'Saturday', emoji:'üèñÔ∏è',short:'Sat'},
  {name:'Sunday',   emoji:'üåü', short:'Sun'},
];
const MONTHS = [
  {name:'January',  emoji:'‚ùÑÔ∏è', short:'Jan'},{name:'February', emoji:'üíù', short:'Feb'},
  {name:'March',    emoji:'üå∏', short:'Mar'},{name:'April',    emoji:'üå¶Ô∏è',short:'Apr'},
  {name:'May',      emoji:'üåª', short:'May'},{name:'June',     emoji:'‚òÄÔ∏è', short:'Jun'},
  {name:'July',     emoji:'üèñÔ∏è',short:'Jul'},{name:'August',   emoji:'üåä', short:'Aug'},
  {name:'September',emoji:'üçÇ', short:'Sep'},{name:'October',  emoji:'üéÉ', short:'Oct'},
  {name:'November', emoji:'üçÅ', short:'Nov'},{name:'December', emoji:'üéÑ', short:'Dec'},
];

const SECTIONS = {
  letters:  { data: LETTERS,  total: 26 },
  numbers:  { data: NUMBERS,  total: 20 },
  weekdays: { data: WEEKDAYS, total: 7  },
  months:   { data: MONTHS,   total: 12 },
};

// ‚îÄ‚îÄ WORD FAMILIES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const WORD_FAMILIES = [
  { family:'-AN', color:'col-red',    words:[
    {word:'can',emoji:'ü•´'},{word:'man',emoji:'üë®'},{word:'fan',emoji:'üåÄ'}
  ]},
  { family:'-AT', color:'col-orange', words:[
    {word:'mat',emoji:'ü™£'},{word:'cat',emoji:'üê±'},{word:'hat',emoji:'üé©'}
  ]},
  { family:'-EN', color:'col-yellow', words:[
    {word:'hen',emoji:'üêî'},{word:'pen',emoji:'üñäÔ∏è'},{word:'ten',emoji:'üîü'}
  ]},
  { family:'-ET', color:'col-green',  words:[
    {word:'pet',emoji:'üêπ'},{word:'jet',emoji:'‚úàÔ∏è'},{word:'wet',emoji:'üíß'}
  ]},
  { family:'-IN', color:'col-blue',   words:[
    {word:'pin',emoji:'üìå'},{word:'fin',emoji:'ü¶à'},{word:'bin',emoji:'üóëÔ∏è'}
  ]},
  { family:'-IT', color:'col-purple', words:[
    {word:'pit',emoji:'üï≥Ô∏è'},{word:'bit',emoji:'üíæ'},{word:'hit',emoji:'ü•ä'}
  ]},
  { family:'-OG', color:'col-pink',   words:[
    {word:'jog',emoji:'üèÉ'},{word:'fog',emoji:'üå´Ô∏è'},{word:'log',emoji:'ü™µ'}
  ]},
  { family:'-OT', color:'col-teal',   words:[
    {word:'dot',emoji:'üîµ'},{word:'pot',emoji:'ü™¥'},{word:'hot',emoji:'üî•'}
  ]},
  { family:'-UG', color:'col-red',    words:[
    {word:'bug',emoji:'üêõ'},{word:'hug',emoji:'ü§ó'},{word:'rug',emoji:'üü´'}
  ]},
  { family:'-UT', color:'col-orange', words:[
    {word:'nut',emoji:'ü•ú'},{word:'hut',emoji:'üõñ'},{word:'cut',emoji:'‚úÇÔ∏è'}
  ]},
];

const COLORS      = ['col-red','col-orange','col-yellow','col-green','col-blue','col-purple','col-pink','col-teal'];
const BAND_COLORS = ['#FF6B6B','#FF9F43','#FFD93D','#6BCB77','#4D96FF','#C56BFF','#FF6EB4','#00CEC9'];
const CONFETTI_COLORS = ['#FF6B6B','#FFD93D','#6BCB77','#4D96FF','#C56BFF','#FF9F43'];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentSection = 'letters';
let currentIndex   = 0;
let currentData    = LETTERS;
let spellEnabled   = true;
let musicOn        = true;
let isReadingAll   = false;
let readAllStop    = false;

// Per-section visited sets
const visited = { letters: new Set(), numbers: new Set(), weekdays: new Set(), months: new Set(), words: new Set() };

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  AUDIO ENGINE (Web Audio API ‚Äî no files needed)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let audioCtx = null;

function getAudioCtx() {
  if (!audioCtx) audioCtx = new AudioCtx();
  if (audioCtx.state === 'suspended') audioCtx.resume();
  return audioCtx;
}

// Play a single beep
function beep(freq, duration, type='sine', volume=0.3, startTime=0) {
  try {
    const ctx  = getAudioCtx();
    const osc  = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.type      = type;
    osc.frequency.setValueAtTime(freq, ctx.currentTime + startTime);
    gain.gain.setValueAtTime(volume, ctx.currentTime + startTime);
    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + startTime + duration);
    osc.start(ctx.currentTime + startTime);
    osc.stop(ctx.currentTime + startTime + duration + 0.05);
  } catch(e) {}
}

// Pop sound ‚Äî tile tap
function playPop() {
  if (!musicOn) return;
  beep(600, 0.06, 'square', 0.15);
  beep(900, 0.08, 'sine',   0.12, 0.05);
}

// Ding ‚Äî between Read All items
function playDing() {
  if (!musicOn) return;
  beep(880, 0.15, 'sine', 0.18);
}

// Chime ‚Äî Well Done / modal open
function playChime() {
  if (!musicOn) return;
  const notes = [523, 659, 784, 1047];
  notes.forEach((f, i) => beep(f, 0.25, 'sine', 0.2, i * 0.13));
}

// Background music ‚Äî simple looping nursery tune
let bgMusicInterval = null;
const BG_MELODY = [
  // Twinkle twinkle style melody: C C G G A A G rest F F E E D D C
  [523,0.18],[523,0.18],[784,0.18],[784,0.18],[880,0.18],[880,0.18],[784,0.35],
  [0,0.15],
  [698,0.18],[698,0.18],[659,0.18],[659,0.18],[587,0.18],[587,0.18],[523,0.35],
  [0,0.2],
  [784,0.18],[784,0.18],[698,0.18],[698,0.18],[659,0.18],[659,0.18],[587,0.35],
  [0,0.15],
  [784,0.18],[784,0.18],[698,0.18],[698,0.18],[659,0.18],[659,0.18],[587,0.35],
  [0,0.25],
];

let bgPlaying = false;
let bgLoopId  = null;

function playBgMusic() {
  if (!musicOn || bgPlaying) return;
  bgPlaying = true;
  let noteIdx = 0;
  let t = 0;

  function scheduleLoop() {
    if (!musicOn) { bgPlaying = false; return; }
    const ctx = getAudioCtx();
    t = ctx.currentTime;
    BG_MELODY.forEach(([freq, dur]) => {
      if (freq > 0) beep(freq, dur * 0.85, 'sine', 0.07, t - ctx.currentTime);
      t += dur + 0.02;
    });
    const totalDur = BG_MELODY.reduce((s, [, d]) => s + d + 0.02, 0) * 1000;
    bgLoopId = setTimeout(scheduleLoop, totalDur - 200);
  }
  scheduleLoop();
}

function stopBgMusic() {
  bgPlaying = false;
  clearTimeout(bgLoopId);
}

// Start music after first user interaction (browser policy)
let musicStarted = false;
function tryStartMusic() {
  if (musicOn && !musicStarted) {
    musicStarted = true;
    playBgMusic();
  }
}
document.addEventListener('click', tryStartMusic, { once: true });

// Music toggle button
const btnMusic = document.getElementById('btnMusic');
btnMusic.addEventListener('click', () => {
  musicOn = !musicOn;
  btnMusic.textContent = musicOn ? 'üéµ Music: ON' : 'üîá Music: OFF';
  btnMusic.classList.toggle('on',  musicOn);
  btnMusic.classList.toggle('off', !musicOn);
  if (musicOn)  { musicStarted = false; tryStartMusic(); }
  else          { stopBgMusic(); }
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SPELL TOGGLE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const spellToggle = document.getElementById('spellToggle');
const spellLabel  = document.getElementById('spellLabel');
spellToggle.addEventListener('change', () => {
  spellEnabled = spellToggle.checked;
  spellLabel.textContent = spellEnabled ? 'ON' : 'OFF';
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  VOICE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let preferredVoice = null;
function loadVoices() {
  const voices = window.speechSynthesis.getVoices();
  preferredVoice =
    voices.find(v => v.lang === 'en-IN') ||
    voices.find(v => v.lang.startsWith('en-IN')) ||
    voices.find(v => v.lang.startsWith('en') && v.name.toLowerCase().includes('female')) ||
    voices.find(v => v.lang.startsWith('en')) || null;
}
if (window.speechSynthesis) {
  loadVoices();
  window.speechSynthesis.onvoiceschanged = loadVoices;
}

function mkU(text, rate=0.72, pitch=1.35) {
  const u = new SpeechSynthesisUtterance(text);
  u.rate = rate; u.pitch = pitch;
  if (preferredVoice) u.voice = preferredVoice;
  return u;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BUILD GRIDS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildGrid(containerId, section, items, mainFn, emojiFn, subFn, fontSize) {
  const g = document.getElementById(containerId);
  items.forEach((item, i) => {
    const tile = document.createElement('div');
    tile.className = `tile ${COLORS[i % COLORS.length]}`;
    tile.id = `tile-${section}-${i}`;
    tile.innerHTML = `
      <div class="t-main" style="font-size:${fontSize}">${mainFn(item)}</div>
      <div class="t-emoji">${emojiFn(item)}</div>
      <div class="t-sub">${subFn(item)}</div>
    `;
    tile.addEventListener('click', () => {
      playPop();
      markVisited(section, i);
      openModal(section, i);
    });
    g.appendChild(tile);
  });
}

buildGrid('grid-letters',  'letters',  LETTERS,  d=>d.letter, d=>d.emoji, d=>d.word,  '2.1rem');
buildGrid('grid-numbers',  'numbers',  NUMBERS,  d=>d.num,    d=>d.emoji, d=>d.word,  '2.1rem');
buildGrid('grid-weekdays', 'weekdays', WEEKDAYS, d=>d.short,  d=>d.emoji, d=>d.name,  '1.35rem');
buildGrid('grid-months',   'months',   MONTHS,   d=>d.short,  d=>d.emoji, d=>d.name,  '1.35rem');

// Build word family tiles
(function buildWordFamilyGrid() {
  const g = document.getElementById('grid-words');
  WORD_FAMILIES.forEach((fam, i) => {
    const tile = document.createElement('div');
    tile.className = `tile ${fam.color}`;
    tile.id = `tile-words-${i}`;
    tile.innerHTML = `
      <div class="t-main" style="font-size:1.6rem">${fam.family}</div>
      <div class="t-emoji">${fam.words.map(w=>w.emoji).join('')}</div>
      <div class="t-sub">${fam.words.map(w=>w.word).join(' ¬∑ ')}</div>
    `;
    tile.addEventListener('click', () => {
      playPop();
      markVisited('words', i);
      openWordDetail(i);
    });
    g.appendChild(tile);
  });
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PROGRESS TRACKER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function markVisited(section, index) {
  visited[section].add(index);
  if (section === 'words') { updateWordsProgress(); return; }
  updateProgress(section);
}

function updateProgress(section) {
  const total   = SECTIONS[section].total;
  const done    = visited[section].size;
  const pct     = Math.round((done / total) * 100);
  document.getElementById(`prog-${section}`).style.width      = pct + '%';
  document.getElementById(`progLabel-${section}`).textContent = `${done}/${total}`;

  // Stars: 1 star per 25% (or per fraction for smaller sets)
  const starCount = Math.floor((done / total) * 5);
  const starsEl   = document.getElementById(`stars-${section}`);
  starsEl.textContent = starCount > 0 ? '‚≠ê'.repeat(starCount) + ` ${done} visited!` : '';

  // Tick visited tiles
  document.querySelectorAll(`[id^="tile-${section}-"]`).forEach((el, i) => {
    el.classList.toggle('visited', visited[section].has(i));
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TABS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    if (isReadingAll) stopReadAll();
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.section-panel').forEach(p => p.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById('panel-' + btn.dataset.tab).classList.add('active');
    currentSection = btn.dataset.tab;
    currentData    = SECTIONS[currentSection].data;
  });
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  READ ALL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
['letters','numbers','weekdays','months'].forEach(sec => {
  document.getElementById(`readAll-${sec}`).addEventListener('click', () => {
    if (isReadingAll && currentSection === sec) { stopReadAll(); return; }
    if (isReadingAll) stopReadAll();
    startReadAll(sec);
  });
});

function startReadAll(section) {
  isReadingAll   = true;
  readAllStop    = false;
  currentSection = section;
  currentData    = SECTIONS[section].data;

  const btn = document.getElementById(`readAll-${section}`);
  btn.textContent = '‚èπ Stop';
  btn.classList.add('stop');

  readAllSequence(section, 0);
}

function stopReadAll() {
  readAllStop  = true;
  isReadingAll = false;
  window.speechSynthesis && window.speechSynthesis.cancel();
  clearAllHighlights();
  ['letters','numbers','weekdays','months'].forEach(sec => {
    const btn = document.getElementById(`readAll-${sec}`);
    btn.classList.remove('stop');
    btn.textContent = '‚ñ∂ Read All';
  });
}

function clearAllHighlights() {
  document.querySelectorAll('.tile.reading').forEach(t => t.classList.remove('reading'));
}

function readAllSequence(section, index) {
  if (readAllStop) { stopReadAll(); return; }

  const data = SECTIONS[section].data;
  if (index >= data.length) {
    // Finished!
    stopReadAll();
    markAllVisited(section);
    setTimeout(() => showWellDone(section), 400);
    return;
  }

  const item    = data[index];
  const tileEl  = document.getElementById(`tile-${section}-${index}`);

  clearAllHighlights();
  if (tileEl) {
    tileEl.classList.add('reading');
    tileEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }

  markVisited(section, index);
  playDing();

  const uList = buildReadAllUtterances(section, item);

  // After last utterance, move to next
  const last = uList[uList.length - 1];
  last.onend = () => {
    if (readAllStop) return;
    setTimeout(() => readAllSequence(section, index + 1), 350);
  };
  last.onerror = () => {
    if (!readAllStop) readAllSequence(section, index + 1);
  };

  window.speechSynthesis.cancel();
  uList.forEach(u => window.speechSynthesis.speak(u));
}

function buildReadAllUtterances(section, item) {
  const uList = [];

  if (section === 'letters') {
    // "A for Apple"
    uList.push(mkU(`${item.letter} for ${item.word}`, 0.72, 1.35));
    if (spellEnabled) {
      item.word.replace(/\s/g,'').split('').forEach(ch => uList.push(mkU(ch, 0.62, 1.35)));
      uList.push(mkU(item.word, 0.78, 1.4));
    }

  } else if (section === 'numbers') {
    uList.push(mkU(`${item.num}. ${item.word}`, 0.75, 1.35));
    if (spellEnabled) {
      item.word.split('').forEach(ch => uList.push(mkU(ch, 0.62, 1.35)));
      uList.push(mkU(item.word, 0.78, 1.4));
    }

  } else if (section === 'weekdays') {
    uList.push(mkU(item.name, 0.75, 1.35));
    if (spellEnabled) {
      item.name.split('').forEach(ch => uList.push(mkU(ch, 0.62, 1.35)));
      uList.push(mkU(item.name, 0.78, 1.4));
    }

  } else { // months
    uList.push(mkU(item.name, 0.75, 1.35));
    if (spellEnabled) {
      item.name.split('').forEach(ch => uList.push(mkU(ch, 0.62, 1.35)));
      uList.push(mkU(item.name, 0.78, 1.4));
    }
  }
  return uList;
}

function markAllVisited(section) {
  const total = SECTIONS[section].total;
  for (let i = 0; i < total; i++) visited[section].add(i);
  updateProgress(section);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  WELL DONE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const wellDoneOverlay = document.getElementById('wellDoneOverlay');
const wellDoneSub     = document.getElementById('wellDoneSub');
const labels = { letters:'Letters', numbers:'Numbers', weekdays:'Weekdays', months:'Months', words:'Word Families' };

function showWellDone(section) {
  wellDoneSub.textContent = `You finished all the ${labels[section]}! üéâ`;
  wellDoneOverlay.classList.add('active');
  spawnConfetti(60);
  playChime();
}

document.getElementById('btnWellDoneClose').addEventListener('click', () => {
  wellDoneOverlay.classList.remove('active');
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const overlay      = document.getElementById('modalOverlay');
const modalBand    = document.getElementById('modalBand');
const modalMain    = document.getElementById('modalMain');
const modalWordLbl = document.getElementById('modalWordLabel');
const modalEmoji   = document.getElementById('modalEmoji');
const countGrid    = document.getElementById('countGrid');
const btnClose     = document.getElementById('btnClose');
const btnSpeak     = document.getElementById('btnSpeak');
const btnPrev      = document.getElementById('btnPrev');
const btnNext      = document.getElementById('btnNext');
const navCounter   = document.getElementById('navCounter');
const speakDots    = document.getElementById('speakDots');

function openModal(section, index) {
  currentSection = section;
  currentData    = SECTIONS[section].data;
  currentIndex   = index;
  updateModal();
  overlay.classList.add('active');
  spawnConfetti(28);
  playChime();
  speakCurrent();
}

function updateModal() {
  const item = currentData[currentIndex];
  modalBand.style.background = BAND_COLORS[currentIndex % BAND_COLORS.length];
  navCounter.textContent = `${currentIndex + 1} / ${currentData.length}`;

  modalEmoji.style.display = 'block';
  countGrid.innerHTML = '';
  countGrid.style.display = 'none';

  if (currentSection === 'letters') {
    modalMain.textContent    = item.letter;
    modalWordLbl.textContent = item.word;
    modalEmoji.textContent   = item.emoji;

  } else if (currentSection === 'numbers') {
    modalMain.textContent    = item.num;
    modalWordLbl.textContent = item.word;
    modalEmoji.style.display = 'none';
    countGrid.style.display  = 'flex';
    const size = item.num <= 5 ? '2.4rem' : item.num <= 10 ? '2rem' : item.num <= 15 ? '1.6rem' : '1.3rem';
    for (let i = 0; i < item.num; i++) {
      const span = document.createElement('span');
      span.textContent = item.emoji;
      span.style.cssText = `font-size:${size};line-height:1.1`;
      countGrid.appendChild(span);
    }

  } else if (currentSection === 'weekdays') {
    modalMain.textContent    = item.short;
    modalWordLbl.textContent = item.name;
    modalEmoji.textContent   = item.emoji;

  } else {
    modalMain.textContent    = item.short;
    modalWordLbl.textContent = item.name;
    modalEmoji.textContent   = item.emoji;
  }

  modalEmoji.style.animation = 'none';
  void modalEmoji.offsetWidth;
  modalEmoji.style.animation = 'popIn 0.45s cubic-bezier(0.34,1.56,0.64,1)';
}

function closeModal() {
  overlay.classList.remove('active');
  window.speechSynthesis && window.speechSynthesis.cancel();
  setSpeaking(false);
}

btnClose.addEventListener('click', closeModal);
overlay.addEventListener('click', e => { if (e.target === overlay) closeModal(); });

btnPrev.addEventListener('click', () => {
  currentIndex = (currentIndex - 1 + currentData.length) % currentData.length;
  markVisited(currentSection, currentIndex);
  updateModal(); speakCurrent();
});
btnNext.addEventListener('click', () => {
  currentIndex = (currentIndex + 1) % currentData.length;
  markVisited(currentSection, currentIndex);
  updateModal(); speakCurrent();
});
btnSpeak.addEventListener('click', speakCurrent);

document.addEventListener('keydown', e => {
  if (!overlay.classList.contains('active')) return;
  if (e.key === 'ArrowRight') btnNext.click();
  if (e.key === 'ArrowLeft')  btnPrev.click();
  if (e.key === 'Escape')     closeModal();
  if (e.key === ' ')          { e.preventDefault(); speakCurrent(); }
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SPEECH (modal)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setSpeaking(val) {
  btnSpeak.classList.toggle('speaking', val);
  speakDots.classList.toggle('visible', val);
  btnSpeak.textContent = val ? 'üîä Speaking...' : 'üîä Say It!';
}

function speakCurrent() {
  if (!window.speechSynthesis) return;
  window.speechSynthesis.cancel();
  setSpeaking(true);
  const item  = currentData[currentIndex];
  const uList = buildReadAllUtterances(currentSection, item);
  uList[uList.length - 1].onend = () => setSpeaking(false);
  uList.forEach(u => window.speechSynthesis.speak(u));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  WORD DETAIL & QUIZ
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentFamilyIndex = 0;

const wordDetailOverlay = document.getElementById('wordDetailOverlay');
const wordFamilyTitle   = document.getElementById('wordFamilyTitle');
const wordCardsGrid     = document.getElementById('wordCardsGrid');
const quizOverlay       = document.getElementById('quizOverlay');
const quizQCount        = document.getElementById('quizQCount');
const quizScore         = document.getElementById('quizScore');
const quizEmoji         = document.getElementById('quizEmoji');
const quizChoices       = document.getElementById('quizChoices');
const btnQuizSpeak      = document.getElementById('btnQuizSpeak');

function openWordDetail(index) {
  currentFamilyIndex = index;
  const fam = WORD_FAMILIES[index];
  wordFamilyTitle.textContent = `${fam.family} Words`;
  wordFamilyTitle.style.color = 'var(--tab-words)';

  // Build word cards
  wordCardsGrid.innerHTML = '';
  fam.words.forEach(w => {
    const card = document.createElement('div');
    card.className = 'word-card';
    card.innerHTML = `<span class="wc-emoji">${w.emoji}</span><span class="wc-word">${w.word}</span>`;
    card.addEventListener('click', () => {
      playPop();
      speakWord(w.word);
    });
    wordCardsGrid.appendChild(card);
  });

  wordDetailOverlay.classList.add('active');
  spawnConfetti(20);
  playChime();
  // Auto-read the family words
  speakFamilyWords(fam);
}

function speakFamilyWords(fam) {
  if (!window.speechSynthesis) return;
  window.speechSynthesis.cancel();
  const uList = [];
  // Say family name first e.g. "A T words"
  uList.push(mkU(`${fam.family.replace('-','')} words`, 0.75, 1.35));
  fam.words.forEach(w => {
    uList.push(mkU(w.word, 0.72, 1.35));
  });
  uList.forEach(u => window.speechSynthesis.speak(u));
}

function speakWord(word) {
  if (!window.speechSynthesis) return;
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(mkU(word, 0.72, 1.35));
}

document.getElementById('btnWordDetailClose').addEventListener('click', () => {
  wordDetailOverlay.classList.remove('active');
  window.speechSynthesis && window.speechSynthesis.cancel();
});

// ‚îÄ‚îÄ QUIZ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let quizQuestions    = [];
let quizCurrentQ     = 0;
let quizCurrentScore = 0;
let quizAnswered     = false;

document.getElementById('btnStartQuiz').addEventListener('click', () => {
  startQuiz(currentFamilyIndex);
});

document.getElementById('btnQuizClose').addEventListener('click', closeQuiz);

function startQuiz(familyIndex) {
  const fam = WORD_FAMILIES[familyIndex];
  // Build questions ‚Äî one per word in the family
  quizQuestions = fam.words.map(w => {
    // Wrong options: 2 from other families, random
    const allOtherWords = WORD_FAMILIES
      .filter((_, i) => i !== familyIndex)
      .flatMap(f => f.words.map(fw => fw.word));
    const shuffled = allOtherWords.sort(() => Math.random() - 0.5);
    const wrongOptions = shuffled.slice(0, 3).filter(o => o !== w.word);
    const options = [w.word, ...wrongOptions.slice(0,3)].sort(() => Math.random() - 0.5);
    return { word: w.word, emoji: w.emoji, options };
  });

  quizCurrentQ     = 0;
  quizCurrentScore = 0;
  quizAnswered     = false;
  quizScore.textContent = '0';
  quizOverlay.classList.add('active');
  showQuizQuestion();
}

function showQuizQuestion() {
  if (quizCurrentQ >= quizQuestions.length) {
    finishQuiz(); return;
  }
  quizAnswered = false;
  const q = quizQuestions[quizCurrentQ];
  quizQCount.textContent = `Q ${quizCurrentQ + 1} / ${quizQuestions.length}`;

  // Emoji
  quizEmoji.textContent = q.emoji;
  quizEmoji.style.animation = 'none';
  void quizEmoji.offsetWidth;
  quizEmoji.style.animation = 'popIn 0.4s cubic-bezier(0.34,1.56,0.64,1)';

  // Auto-speak the word
  setTimeout(() => speakWord(q.word), 300);

  // Build choice buttons
  quizChoices.innerHTML = '';
  q.options.forEach(opt => {
    const btn = document.createElement('button');
    btn.className = 'quiz-choice';
    btn.textContent = opt;
    btn.addEventListener('click', () => handleQuizAnswer(btn, opt, q.word));
    quizChoices.appendChild(btn);
  });
}

function handleQuizAnswer(btn, chosen, correct) {
  if (quizAnswered) return;
  quizAnswered = true;

  if (chosen === correct) {
    btn.classList.add('correct');
    quizCurrentScore++;
    quizScore.textContent = quizCurrentScore;
    playChime();
    spawnConfetti(25);
  } else {
    btn.classList.add('wrong');
    // Show correct
    document.querySelectorAll('.quiz-choice').forEach(b => {
      if (b.textContent === correct) b.classList.add('correct');
    });
    beep(200, 0.3, 'sawtooth', 0.15);
  }

  setTimeout(() => {
    quizCurrentQ++;
    showQuizQuestion();
  }, 1100);
}

function finishQuiz() {
  closeQuiz();
  const total = quizQuestions.length;
  const fam   = WORD_FAMILIES[currentFamilyIndex];
  document.getElementById('wellDoneSub').textContent =
    `${fam.family} Quiz: ${quizCurrentScore} out of ${total}! üéâ`;
  document.getElementById('wellDoneOverlay').classList.add('active');
  spawnConfetti(60);
  playChime();
}

function closeQuiz() {
  quizOverlay.classList.remove('active');
  window.speechSynthesis && window.speechSynthesis.cancel();
}

btnQuizSpeak.addEventListener('click', () => {
  if (quizCurrentQ < quizQuestions.length) {
    speakWord(quizQuestions[quizCurrentQ].word);
  }
});

// Update progress for words section (10 families)
function updateWordsProgress() {
  const total = 10;
  const done  = visited['words'].size;
  const pct   = Math.round((done / total) * 100);
  document.getElementById('prog-words').style.width      = pct + '%';
  document.getElementById('progLabel-words').textContent = `${done}/${total}`;
  const starCount = Math.floor((done / total) * 5);
  const starsEl   = document.getElementById('stars-words');
  starsEl.textContent = starCount > 0 ? '‚≠ê'.repeat(starCount) + ` ${done} visited!` : '';
  document.querySelectorAll('[id^="tile-words-"]').forEach((el, i) => {
    el.classList.toggle('visited', visited['words'].has(i));
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CONFETTI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function spawnConfetti(count = 30) {
  const container = document.getElementById('confettiContainer');
  container.innerHTML = '';
  for (let i = 0; i < count; i++) {
    const p = document.createElement('div');
    p.className = 'confetti-piece';
    p.style.cssText = `
      left: ${Math.random()*100}%;
      top: -10px;
      background: ${CONFETTI_COLORS[Math.floor(Math.random()*CONFETTI_COLORS.length)]};
      width:  ${6+Math.random()*8}px;
      height: ${6+Math.random()*8}px;
      border-radius: ${Math.random()>0.5?'50%':'3px'};
      animation-delay:    ${Math.random()*0.6}s;
      animation-duration: ${1.2+Math.random()*0.8}s;
    `;
    container.appendChild(p);
  }
  setTimeout(() => container.innerHTML = '', 3000);
}
</script>
</body>
</html>
